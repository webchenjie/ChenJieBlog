---
title: 音视频原理
date: 2024-04-23
tags:
    - 前端
categories:
    - 技术
---

## 简述

### 音视频的应用

-   互动直播系统，如一对一视频等
-   娱乐直播系统，如主播等
-   音视频特效
-   音视频编辑

### 常用工具

-   ffmpeg 对音视频的编码解码，特效处理等
-   ffplay 基于 ffmpeg，播放器
-   vlc 依赖于 ffmpeg，播放器，有图形化界面

### 如何安装

-   Mac 使用命令安装 brew install ffmpeg
-   Mac/Linux 源码方式安装
    -   下载 ffmpeg，http://ffmpeg.org/download.html
    -   编译 ffmpeg
        -   ./configure --prefix=/usr/local/ffmpeg --enable-debug=3 （生成编译脚本，并打开调试模式）
        -   make -j 4 （指定四个进程同时进行编译）
        -   make install（安装）
-   Windows 编译方式
    -   Cygwin（Cygnus Windows） 直接安装
    -   MinGW（Minimalist GNU for Windows） + MSYS2（Minimal SYStem2）（推荐）
    -   VS（Visual Studio 2015/2017...） + MSYS2（Minimal SYStem2）

### 音视频处理流程

-   直播客户端的处理流程
    -   音视频采集 ==> 音视频编码 ==> 传输 ==> 音视频解码 ==> 音视频渲染

## 音频

### 声音是如何被听到的

> 人类听觉范围在：20Hz —— 20kHz 之间

-   声音是由物体振动产生的
-   它可以通过空气、固体、液体等进行传输
-   振动耳膜

### 声音三要素

-   音调
-   音量
-   音色

### 模数转换（模拟信号转数字信号）

-   对声音进行量化，即采样，常见的采样率有 48000/s、32000/s、16000/s、8000/s，采样率越高，还原度越高
-   拿到采样结果再转为二进制格式，采样一般是十进制，最后得到二进制方波

### 音频原始数据格式

-   PCM （纯粹的原始数据）
-   WAV （在 PCM 上加了些基本的头信息，便于播放器识别）
    -   头信息包含了 WAV 的标识，也包含了采样大小、采样率、声道数等信息，也就是说可以通过头信息得到对应文件的信息
-   量化的基本概念
    -   采样大小：一个采样用多少 bit 存放，常用的是 16bit
    -   采样率：采样频率 8k、16k、32k、44.1k、48k
    -   声道数：单声道、双声道、多声道（立体声）
-   码率计算：
    -   一个 PCM 音频流的码率计算 = 采样率 \* 采样大小 \* 声道数
    -   例子：采样率为 44.1KHz，采样大小为 16bit，双声道的 PCM 编码的 WAV 文件，它的码率为 44.1K \* 16 \* 2 = 1411.2Kb/s

### 音频数据的流转

-   PCM（采集到的原始数据，即数字信号）==> aac/mp3（编码器，即得到压缩后的数据）==> mp4/flv（多媒体文件，格式）
-   以上步骤，可以反过来，即从一个多媒体文件解析成原始数据

### 音频采集

-   各个平台都有对应的 API，如 Android、iOS、Windows，并且每个平台都有多套的 API
-   而 FFmpeg 封装了各个平台的 API，可以兼容各个平台
-   通过命令采集
    -   ffmpeg -f avfoundation -i :0 out.wav（注意这个 avfoundation 和 :0，是 Mac 平台下的 API，如果是其他平台则需要使用其他平台的 API，可到官网搜索）
    -   ffplay out.

::: tip
作者：chenjie <br/>
链接：https://webchenjie.cn <br/>
来源：ChenJieBlog
:::
