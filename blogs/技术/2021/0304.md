---
title: uniPush
date: 2021-03-04
tags:
  - uni-app
categories:
  - 技术
---
## 概述
    1. UniPush是DCloud联合个推公司推出的集成型统一推送服务，内建了苹果、华为、小米、OPPO、VIVO、魅族、谷歌FCM等
        手机厂商的系统级推送和个推等第三方推送。
    2. 在没有uniPush以前，如果只使用三方push，会在很多国产手机上因为节电设置而无法保活push进程，导致无法推送。
        而如果每个安卓手机的官方Push SDK都集成开发一遍，这么多平台，工作量会非常巨大，管理维护也很麻烦。
    3. uniPush解决了这个难题，开发者只需要开发一次。系统会自动在不同手机上选择最可靠的推送通道发送push消息，保障送达率。

## 整体架构
  ![整体架构](https://vkceyugu.cdn.bspapp.com/VKCEYUGU-e1adcd38-dd22-458d-a547-6e4ff9b727c3/0c476449-b5a2-4c30-9bfe-82d3534db6b5.png)

## 如何开通uniPush?
    1. Dcloud 开发者账号
    2. Android 证书
    3. IOS 证书
    4. IOS 开发者账号
    5. IOS 推送证书

## 消息推送流程
    1. Android平台
      APP在线（个推推送通道可用）推送通知和透传消息都使用个推的推送通道下发推送消息。
      APP离线（个推推送通道不可用）推送通知，使用个推离线推送通道，离线消息会存储在消息离线库，离线时间内APP	在线后下发推送消息。
      透传消息，如果符合厂商推送的厂商手机（配置了手机厂商推送参数并且在对应厂商的手机上），则使用厂商推送通道下发推送消息，
      否则使用个推的离线推送通道，离线消息会存储在消息离线库，离线时间内APP在线后下发推送消息。
    2. iOS平台
      推送通知，uniPush后台管理界面中不支持下发此类型，个推提供的服务端API支持下发推送通知
      （设置APN参数则通过苹果的APNS通道，否则使用个推通道）。
      透传消息，设置APN参数则通过苹果的APNS通道下发推送消息，没有设置APN参数则使用个推的推送通道下发。
    3. 简单理解
        Android 平台有区分在线和离线，在线使用个推第三方推送，离线使用对应手机厂商推送
        IOS 平台不区分在线和离线，而是通过入参采用哪种通道推送（使用个推或APN都可以）
        推送通知和透传消息区别，一个是普通的文本，一个是 JSON 串

## 厂商推送设置
    1. 登录DCloud开发者后台找到应用，现uniPush支持的手机厂商有魅族、OPPO、华为、小米、VIVO、FCM
        需前往对应的手机厂商平台申请开发者账号，把对应的 ID、Key 填入
  ![厂商推送设置](https://vkceyugu.cdn.bspapp.com/VKCEYUGU-e1adcd38-dd22-458d-a547-6e4ff9b727c3/6fc737ed-5c07-43bf-8a4a-a98ac1f01309.png)

## uniPush 服务端接口推送集成
    1. 通过以上知识我们已经知道，要么使用个推要么使用手机厂商，而 uni-app 已帮我们集成了其他手机厂商的 SDK
        只要去对应的手机厂商申请开发者进行配置就可以，也就是说我们只要去集成个推的 SDK，就能实现推送全覆盖。
  ![uniPush 服务端接口推送集成](https://vkceyugu.cdn.bspapp.com/VKCEYUGU-e1adcd38-dd22-458d-a547-6e4ff9b727c3/ad54ec29-318b-4d62-a592-a0a4004af19a.png)

## 常见误解
    常见误解1：“uniPush的专业性，和专业的个推、极光等服务可相比吗？”
    答：uniPush是由个推将其本来收费的vip push产品，免费提供给了DCloud的开发者。它与个推vip push的只有2个区别：
    1、免费；2、账户使用的是DCloud开发者账户，而无需再重新注册个推账户。个推是A股上市公司，专业性在推送领域领先。

    常见误解2：“uniPush好麻烦，我就喜欢个推、极光这种简单sdk，不想去各个rom厂商去申请一圈”
    答：uniPush不建立在申请手机厂商授权的基础上，如果你不申请那些，使用起来和用普通的个推是一样的。
    但是要特别注意，推送行业的现状就是：不集成rom厂商的推送，就无法在App离线时发送push。按照普通个推模式使用，
    后果就是在华为、小米、OPPO、VIVO、魅族上发不了离线消息。

    常见误解3：“uniPush的送达率还是不够，是否可以付费来提升送达率，个推是有付费提升送达率的方法的”
    答：前文已经说了。个推的付费提升送达率的产品就是vip push，而uniPush就是个推的vip Push。DCloud通过谈判免费给DCloud的开发者使用了。

    常见误解4：开通uniPush要实名认证，还得传身份证，开通普通个推不用这么麻烦。
    答：此问题之前曾存在，后来已经处理，保持和个推需要的身份信息相同，不再需要身份证。

## 参考连接
    1. UniPush 开通指南官方：https://ask.dcloud.net.cn/article/35716
    2. UniPush 使用指南官方：https://ask.dcloud.net.cn/article/35622
    3. 个推接口文档官方：https://docs.getui.com/getui/server/rest_v2/introduction/

::: tip
作者：chenjie <br>
链接：https://webchenjie.cn <br>
来源：ChenJieBlog
:::
