(window.webpackJsonp=window.webpackJsonp||[]).push([[94],{690:function(t,s,a){"use strict";a.r(s);var r=a(11),e=Object(r.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[t._v("#")]),t._v(" 简介")]),t._v(" "),a("p",[t._v("所谓的编译器就是 Vue 中的 comiler，它会把 template 转换为 render")]),t._v(" "),a("p",[t._v("主要是三大步骤：")]),t._v(" "),a("ul",[a("li",[t._v("解析（parse）template 模板，生成 AST")]),t._v(" "),a("li",[t._v("转化（transform）AST，得到 JS AST")]),t._v(" "),a("li",[t._v("生成（generate）render 函数")])]),t._v(" "),a("h3",{attrs:{id:"什么是-dsl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是-dsl"}},[t._v("#")]),t._v(" 什么是 DSL？")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("领域特定语言（DSL）指的仅为某个适用的领域而设计的，并提供解决方案，在 Vue 中可以简单理解为就是把 template 模板编译成 render 函数的过程就是 compiler 编译器")])]),t._v(" "),a("li",[a("p",[t._v("正常的编译过程可以理解为把 A 语言转换为 B 语言，即源代码转换为目标代码，流程主要是以下步骤")]),t._v(" "),a("ul",[a("li",[t._v("源代码 ==> 词法分析 ==> 语法分析 ==> 语义分析 ==> 中间代码生成 ==> 中间代码优化 ==> 目标代码生成 ==> 目标代码优化 ==> 目标代码")])])]),t._v(" "),a("li",[a("p",[t._v("在 Vue 中，把 template 转换为 render 会比较简单些，主要是以下步骤")]),t._v(" "),a("ul",[a("li",[t._v("源代码（template） ==> 错误分析 ==> parse（生成 AST） ==> transform（生成 js AST） ==> 目标代码（render）")])])])]),t._v(" "),a("h3",{attrs:{id:"什么是-ast"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是-ast"}},[t._v("#")]),t._v(" 什么是 AST？")]),t._v(" "),a("ul",[a("li",[t._v("抽象语法树（AST）指的是源代码语法结构的一种抽象表示，这边更多的是 template 的抽象")]),t._v(" "),a("li",[t._v("AST 本质上也是一个 js 对象")]),t._v(" "),a("li",[t._v("和 vnode 的区别？\n"),a("ul",[a("li",[t._v("这边大家可能会有些疑惑，因为 vnode 的结构和 AST 的结构很类似，认为它们是不是一样的，实际上不是，AST 可以理解为是模板的抽象表示，而 vnode 是 DOM 树的抽象表示，是不同阶段的产物，模板包含各种指令或其他 Vue 的代码，而 vnode 中没有")])])])]),t._v(" "),a("h3",{attrs:{id:"什么是-js-ast"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是-js-ast"}},[t._v("#")]),t._v(" 什么是 JS AST？")]),t._v(" "),a("ul",[a("li",[t._v("在生成了 AST 后，通过 transform 会生成 JS AST")]),t._v(" "),a("li",[t._v("JS AST 和 AST 的主要区别是新增了 codegenNode 节点，即代码生成节点")])]),t._v(" "),a("h3",{attrs:{id:"什么是有限状态机"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是有限状态机"}},[t._v("#")]),t._v(" 什么是有限状态机？")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("有限个状态以及在这些状态之间的转移和动作等行为的数学计算模型")]),t._v(" "),a("ul",[a("li",[t._v("状态总数是有限的")]),t._v(" "),a("li",[t._v("任一时刻，只处在一种状态之中")]),t._v(" "),a("li",[t._v("某种条件下，会从一种状态转变到另一种状态")])])]),t._v(" "),a("li",[a("p",[t._v("比如有一段模板代码")])])]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("hello world"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("上面这段代码的解析可以拆分为以下步骤：")]),t._v(" "),a("ol",[a("li",[t._v("解析 <：由初始状态进入标签开始状态")]),t._v(" "),a("li",[t._v("解析 div：由标签开始状态进入标签名称状态")]),t._v(" "),a("li",[t._v("解析 >：由标签名称状态进入初始状态")]),t._v(" "),a("li",[t._v("解析 hello world：由初始状态进入文本状态")]),t._v(" "),a("li",[t._v("解析 <：由文本状态进入标签开始状态")]),t._v(" "),a("li",[t._v("解析 /：由标签开始状态进入结束标签状态")]),t._v(" "),a("li",[t._v("解析 div：由结束标签状态进入结束标签名称状态")]),t._v(" "),a("li",[t._v("解析 >：由结束标签名称状态进入初始状态")])]),t._v(" "),a("p",[t._v("经过这些解析会得到三个 token：")]),t._v(" "),a("ul",[a("li",[t._v("开始标签："),a("code",[t._v("<div>")])]),t._v(" "),a("li",[t._v("文本节点：hello world")]),t._v(" "),a("li",[t._v("结束标签："),a("code",[t._v("</div>")])])]),t._v(" "),a("p",[t._v("当有了这些 token，Vue 会使用 "),a("code",[t._v("递归下降算法")]),t._v(" 进行构建生成 AST")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ast "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("children")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("tag")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'div'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("tagType")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("props")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("children")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("content")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello world'")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("loc")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br")])])])}),[],!1,null,null,null);s.default=e.exports}}]);